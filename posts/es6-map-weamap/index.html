<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>ES6新特性-Map和WeakMap | Yizhou&#39;s Website</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="参考文档：MDN Map结构 🔗在Javascript中，对象是以键值对的方式存在的，其中的键名是以字符串或者数值以及ES6提出的新的数据类型S">
<meta name="generator" content="Hugo 0.121.1">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />




  





    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          "HTML-CSS": { scale: 85 },
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            processEscapes: true
          }
        });
    </script>
    
    <script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>





  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>首页</a>
	
	<a href="/posts">归档</a>
	<a href="/tags">标签</a>
	<a href="/about">关于</a>

	

	
	  <a class="button" href="https://wuyizhou.com/index.xml">订阅</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">ES6新特性-Map和WeakMap</h1>

    <div class="tip">
        <time datetime="2017-07-11 08:54:39 &#43;0000 UTC">2017年07月11日</time>
        <span class="split">
          ·
        </span>
        <span>
          1321字
        </span>
        <span class="split">
          ·
        </span>
        <span>
          3分钟
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#map结构">Map结构</a></li>
        <li><a href="#weakmap结构">WeakMap结构</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <p>参考文档：<a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noopener">MDN</a></p>
<h3 id="map结构">Map结构 <a href="#map%e7%bb%93%e6%9e%84" class="anchor">🔗</a></h3><p>在Javascript中，对象是以键值对的方式存在的，其中的键名是以<code>字符串</code>或者<code>数值</code>以及ES6提出的新的数据类型<code>Symbol</code>方式存在的，比如下面：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>let m = {
</span></span><span style="display:flex;"><span>    k: 1,
</span></span><span style="display:flex;"><span>    2: 4
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m.k; // 1
</span></span><span style="display:flex;"><span>m[2]; //4 
</span></span></code></pre></div><p>但是无法使用引用类型数据作为键名：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">const</span> body <span style="color:#666">=</span> document<span style="color:#666">.</span>getElementsByTagName(<span style="color:#b44">&#39;body&#39;</span>)[<span style="color:#666">0</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>let m <span style="color:#666">=</span> {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>k <span style="color:#666">=</span> <span style="color:#666">1</span>;
</span></span><span style="display:flex;"><span>m[body] <span style="color:#666">=</span> <span style="color:#666">4</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m; <span style="color:#666">//</span> {k: <span style="color:#666">1</span>, [object HTMLBodyElement]: <span style="color:#666">4</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m[<span style="color:#b44">&#39;[object HTMLBodyElement]&#39;</span>]; <span style="color:#666">//</span> <span style="color:#666">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666">/*</span>
</span></span><span style="display:flex;"><span>    <span style="">从这里看出来其实当我们用</span>DOM对象作为m属性的时候<span style="">，</span>
</span></span><span style="display:flex;"><span>    <span style="">实际上并没有把</span>DOM对象作为键名<span style="">，而是通过把</span>DOM对象
</span></span><span style="display:flex;"><span>    toString()<span style="">方法的返回字符串值当作了键名。</span>
</span></span><span style="display:flex;"><span><span style="color:#666">*/</span> 
</span></span></code></pre></div><p>ES6提出了一种新的结构来解决引用类型作为键值不能实现的问题。Map类型，Map类型可以使用任意数据类型作为键值。Map类型常用的方法及属性有以下几种：</p>
<p><code>Map.prototype.size</code>:返回Map对象的键值对</p>
<p><code>Map.prototype.clear()</code>:移除Map结构中所有的键值对</p>
<p><code>Map.prototype.delete(key)</code>:移除key键，成功返回true，反之false</p>
<p><code>Map.prototype.get(key)</code>:或者key键的值，如果不存在返回undefined</p>
<p><code>Map.prototype.set(key, value)</code>:设置Map键值。key作为键，value作为键值</p>
<p><code>Map.prototype.has(key)</code>:查找是否在当前Map结构中存在key键，返回true和false</p>
<p>当然还有其他和Set结构一样的方法没有列举出来，如果想见全部方法，大家可以到<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="noopener">MDN</a>文档查看。</p>
<p>Map是一个构造函数，可以接受一个参数，此参数是数组，此数组的成员为键值对或者两个元素的数组，每个元素或者键值对会被添加到Map结构中，null为undefined。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>let tmp <span style="color:#666">=</span> [[<span style="color:#b44">&#39;name&#39;</span>, <span style="color:#b44">&#39;tom&#39;</span>],[<span style="color:#b44">&#39;age&#39;</span>, <span style="color:#666">18</span>]];
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">const</span> m <span style="color:#666">=</span> new Map(tmp); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>get(<span style="color:#b44">&#39;name&#39;</span>); <span style="color:#666">//</span><span style="color:#b44">&#39;tom&#39;</span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>get(<span style="color:#b44">&#39;age&#39;</span>); <span style="color:#666">//</span> <span style="color:#666">18</span> 
</span></span></code></pre></div><p>使用引用类型当键值</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">const</span> body <span style="color:#666">=</span> document<span style="color:#666">.</span>getElementsByTagName(<span style="color:#b44">&#39;body&#39;</span>)[<span style="color:#666">0</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">const</span> m <span style="color:#666">=</span> new Map();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>set(body, <span style="color:#b44">&#39;this is body&#39;</span>); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>get(body); <span style="color:#666">//</span> <span style="color:#b44">&#39;this is body&#39;</span> 
</span></span></code></pre></div><p>这里需要注意的一点是引用类型是指的是变量名其实存储的是一个内存地址，并不是真正存储的数据，也就是说变量存储的是一个指针，所以两个引用类型数据值可能一样，但是内存地址不一样。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>let tmpA <span style="color:#666">=</span> [<span style="color:#b44">&#39;body&#39;</span>];
</span></span><span style="display:flex;"><span>let tmpB <span style="color:#666">=</span> [<span style="color:#b44">&#39;body&#39;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">const</span> m <span style="color:#666">=</span> new Map();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>set(tmpA, <span style="color:#b44">&#39;this is body&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>has(tmpA); <span style="color:#666">//</span> true
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>get(tmpA); <span style="color:#666">//</span> <span style="color:#b44">&#39;this is body&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>has(tmpB); <span style="color:#666">//</span> false
</span></span><span style="display:flex;"><span>m<span style="color:#666">.</span>get(tmpB); <span style="color:#666">//</span> undefined 
</span></span></code></pre></div><h3 id="weakmap结构">WeakMap结构 <a href="#weakmap%e7%bb%93%e6%9e%84" class="anchor">🔗</a></h3><p>WeakMap结构和WeakSet结构非常非常相似，它们都是弱引用，并且它们的键只能是对象，不能是基本类型的值。当一个对象被WeakMap当作键/值，这次引用是不计入引用计数的，那么垃圾回收器回收的时候会回收掉这个对象，并且WeakMap会自动销毁这个键值对，如果在这个对象销毁后获取，将会返回undefined。</p>
<p>WeakMap只有四个方法。并且没有遍历方法，因为很有可能在遍历的过程中垃圾回收器就回收掉，所以没有遍历的方法。</p>
<p><code>WeakMap.prototype.set(key, value)</code>:设置一个键值对，并返回当前WeakMap对象。</p>
<p><code>WeakMap.prototype.get(key)</code>: 获取key键的值</p>
<p><code>WeakMap.prototype.has(key)</code>: 判断key键是否存在当前WeakMap结构中</p>
<p><code>WeakMap.prototype.delete(key)</code>: 删除当前WeakMap结构中的key键/值对。</p>
<p>WeakMap非常好用的是将WeakMap作为一些对象的状态值、属性值，当这个对象销毁的时候，那么WeakMap中的状态值就会跟着销毁，比如下面就是一个很好的例子，一个html网页，当发生click事件，就会在状态中+1，如果大于5次，就销将这个DOM节点；</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">const</span> DOMclick <span style="color:#666">=</span> document<span style="color:#666">.</span>getElementById(<span style="color:#b44">&#39;site-navigation&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">const</span> wm <span style="color:#666">=</span> new WeakMap();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wm<span style="color:#666">.</span>set(DOMclick, {ClickNum: <span style="color:#666">0</span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>function clickFunction(<span style="color:#666">...</span>arg){
</span></span><span style="display:flex;"><span>    let tmp <span style="color:#666">=</span> wm<span style="color:#666">.</span>get(DOMclick);
</span></span><span style="display:flex;"><span>    <span style="color:#a2f;font-weight:bold">if</span>( tmp<span style="color:#666">.</span>ClickNum <span style="color:#666">&gt;=</span> <span style="color:#666">5</span>) {
</span></span><span style="display:flex;"><span>        DOMclick<span style="color:#666">.</span>removeEventListener(<span style="color:#b44">&#39;click&#39;</span>, clickFunction);
</span></span><span style="display:flex;"><span>        DOMclick <span style="color:#666">=</span> null;
</span></span><span style="display:flex;"><span>    } <span style="color:#a2f;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        tmp<span style="color:#666">.</span>ClickNum <span style="color:#666">+=</span> <span style="color:#666">1</span>;
</span></span><span style="display:flex;"><span>        wm<span style="color:#666">.</span>set(DOMclick, tmp);
</span></span><span style="display:flex;"><span>        console<span style="color:#666">.</span>log(<span style="color:#b44">&#39;ClickNum: &#39;</span>,   wm<span style="color:#666">.</span>get(DOMclick)<span style="color:#666">.</span>ClickNum);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DOMclick<span style="color:#666">.</span>addEventListener(<span style="color:#b44">&#39;click&#39;</span>, clickFunction); 
</span></span></code></pre></div><p>文完</p>

    </div>

    
        <div class="tags">
            
                <a href="https://wuyizhou.com/tags/%E5%BC%80%E5%8F%91%E8%80%85%E6%89%8B%E5%86%8C">开发者手册</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/wyizhou" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://stackoverflow.com/users/11949960" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>stackoverflow</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-488.000000, -1163.000000)">
            <g id="stackoverflow" transform="translate(488.000000, 1163.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M42.0860128,53.5922927 L22.9745951,53.6011499 L22.9729497,49.5538824 L42.0835447,49.5440929 L42.0860128,53.5922927 L42.0860128,53.5922927 Z M55,30.6708298 L51.7306912,12 L47.7087256,12.6920259 L50.9775643,31.3628557 L55,30.6708298 L55,30.6708298 Z M42.5455518,44.3547147 L23.5156994,42.616026 L23.1410164,46.6470941 L42.1712214,48.3841513 L42.5455518,44.3547147 L42.5455518,44.3547147 Z M43.8009984,39.0731519 L25.3459811,34.1539179 L24.285633,38.0621508 L42.7419431,42.9819676 L43.8009984,39.0731519 L43.8009984,39.0731519 Z M46.2103463,34.4436411 L29.7494464,24.8164635 L27.6748215,28.3015328 L44.1365441,37.9292931 L46.2103463,34.4436411 L46.2103463,34.4436411 Z M50.2466504,31.6088756 L46.8745036,33.8883189 L36.106599,18.2318456 L39.4792159,15.9517031 L50.2466504,31.6088756 Z M45.3315807,40.2784283 L48.5799693,40.2784283 L48.5799693,60 L17,60 L17,40.2784283 L20.2648427,40.2784283 L20.2648427,56.8243495 L45.3315807,56.8243495 L45.3315807,40.2784283 Z" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="https://twitter.com/5yizhou" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <div class="copyright">
    
        © Copyright 2023 Yizhou
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-mini'>nodejh</a>
      </div>
    
</footer>



  </body>
</html>

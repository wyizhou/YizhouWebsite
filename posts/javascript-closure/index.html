<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>浅谈Javascript闭包 | Yizhou&#39;s Website</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="垃圾回收器 🔗我个人把闭包抽象的称之为”阻止垃圾回收器的函数”或者”有权访问另一个函数内部变量的函数&quot;(当然这个是我个人的理解方式，">
<meta name="generator" content="Hugo 0.121.1">


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />




  





    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          "HTML-CSS": { scale: 85 },
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            processEscapes: true
          }
        });
    </script>
    
    <script src='https://cdn.jsdelivr.net/npm/mathjax@2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>





  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">←</span>首页</a>
	
	<a href="/posts">归档</a>
	<a href="/tags">标签</a>
	<a href="/about">关于</a>

	

	
	  <a class="button" href="https://wuyizhou.com/index.xml">订阅</a>
	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">浅谈Javascript闭包</h1>

    <div class="tip">
        <time datetime="2015-03-27 20:01:00 &#43;0000 UTC">2015年03月27日</time>
        <span class="split">
          ·
        </span>
        <span>
          2088字
        </span>
        <span class="split">
          ·
        </span>
        <span>
          5分钟
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#垃圾回收器">垃圾回收器</a></li>
        <li><a href="#引用计数">引用计数</a></li>
        <li><a href="#标记清除">标记清除 </a></li>
        <li><a href="#什么是闭包">什么是闭包？</a></li>
        <li><a href="#闭包是怎么形成的">闭包是怎么形成的？</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <h3 id="垃圾回收器">垃圾回收器 <a href="#%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6%e5%99%a8" class="anchor">🔗</a></h3><p>我个人把闭包抽象的称之为”阻止垃圾回收器的函数”或者”有权访问另一个函数内部变量的函数&quot;(当然这个是我个人的理解方式，每个人可能会有不同的理解方式)，为什么这样说？这样说还得说说垃圾回收器，一些编程语言如C语言对于内存管理是由程序员说了算，也就是说程序员决定这个变量是否还需要，如果不需要就释放这个变量占用的空间，而这个变量也不复存在了，这样做的好处是可以及时释放内存空间，让那些需要使用内存空间的程序来使用。</p>
<p>而在Javascript中，我们是不需要这样做的，Javascript有一个叫”垃圾回收器”的系统，它会自动对于那些我们不再使用的变量进行回收。那问题来了，它怎么知道我们不再需要这个变量了？在Javascript里面有两个回收机制一个为：”引用计数”，另外一个为&quot;标记清除&quot;，垃圾回收器会根据代码里面对变量的调用(引用)来判断，如果这个变量的调用(引用)为0那么就表示可以回收了。</p>
<h3 id="引用计数">引用计数 <a href="#%e5%bc%95%e7%94%a8%e8%ae%a1%e6%95%b0" class="anchor">🔗</a></h3><p>引用计数是如何工作？拿一个例子来说吧：</p>
<p>“有一家公司的小明，他工作是和销售有关的，所以他每天会开公司的车去见客户、接客户进行推销。而取得公车的步骤需要向管车的王大爷进行预约，然后王大爷会把预约纪录到今天的预约表上，使用完后需要把车交给王大爷并把记录划掉。有一天小明需要使用公车，小明打电话给王大爷表明他下午两点会使用公车，王大爷随后把此次预约纪录到了今天的预约表上，到了约定时间，小明取到了公车。随后与客户一番见面商谈过后把公车交还给王大爷，王大爷同时也把预约表上的小明这一条记录给划掉，王大爷随后看了看预约表，今天没有人预约了，看来可以早点下班了，于是把车停回车库下班了。”</p>
<p>其实上面的例子可以看出来，王大爷相当于”垃圾回收器”，而王大爷依据什么来进行处理回收的？是根据预约表，而这个预约表就相当于”引用计数”,当这个预约表上没有人预约公车的时候，王大爷就把车停回了车库，当然如果还有预约王大爷还得一直等待预约表上没有任何预约了才能把车停回车库并下班。也就相当于当这个变量没有人在需要使用的时候，这个变量就可以被“回收”了。</p>
<h3 id="标记清除">标记清除  <a href="#%e6%a0%87%e8%ae%b0%e6%b8%85%e9%99%a4" class="anchor">🔗</a></h3><p>这一节点很感谢&quot;<a href="http://www.cnblogs.com/silin6/" target="_blank" rel="noopener">linkFly</a>&ldquo;前辈指出我的错误，我错误的把&quot;引用计数&quot;理解为最常用的计数了，所以在这里感谢&rdquo;<a href="http://www.cnblogs.com/silin6/" target="_blank" rel="noopener">linkFly</a>&ldquo;前辈。</p>
<p>目前&quot;标记清除&quot;技术是最常用的一种内存回收机制，现在chrome和Safari以及新版本IE、opera等浏览器均采用这样的内存回收机制。</p>
<p>&ldquo;标记清除&quot;不同于&quot;引用计数&rdquo;，标记清除更加简单，相当于告诉我们这个变量能使用或者不能用。当一个变量声明的时候，变量会被标记为&quot;进入环境&rdquo;,而当变量离开了环境过后就标记为&quot;离开环境&quot;。</p>
<p>标记清除的工作方式大概为：</p>
<p>首先javascript会在全局中给所有的变量加上标记，然后去掉在环境中的变量以及环境中被引用的变量的标记，其他被标记的变量表示可以清除的变量，在垃圾回收器执行的时候将会把这些变量清除掉。</p>
<h3 id="什么是闭包">什么是闭包？ <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e9%97%ad%e5%8c%85" class="anchor">🔗</a></h3><p>在正常的回收机制下，当我们不再使用这个函数或者变量的时候就会被回收，不再使用是指在当前我们执行的状态之后没有出现在调用(引用)变量的语句了。下面有一个例子，简单的介绍了一下闭包，例子中logHello被赋值一个自执行匿名函数返回的函数，这个函数是有权限访问自执行匿名函数内部的log_num变量的，这样的函数被称为闭包，因为返回的函数内部有一个对自执行匿名函数内部log_num变量的引用。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span> <span style="color:#666">1</span> <span style="color:#a2f;font-weight:bold">var</span> logHello; <span style="color:#666">2</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">3</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">4</span> logHello <span style="color:#666">=</span> ( function () { <span style="color:#666">5</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">6</span>     <span style="color:#a2f;font-weight:bold">var</span> <span style="color:#a2f">log</span>\_num <span style="color:#666">=</span> <span style="color:#666">20</span>;
</span></span><span style="display:flex;"><span> <span style="color:#666">7</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">8</span>     <span style="color:#a2f;font-weight:bold">return</span> function() {
</span></span><span style="display:flex;"><span> <span style="color:#666">9</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">10</span>            <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">log</span>\_num; <span style="color:#666">11</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">12</span> }; <span style="color:#666">13</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">14</span> } )();
</span></span></code></pre></div><p>下面还有一个例子，logHello被赋值自执行函数返回的一个对象，这个对象里面包含了两个方法”read”和”write”，这两个方法都属于闭包，他们都有权访问log_name变量。”read”负责读取log_name这个变量的值,而”write”负责重写log_name的值，在外部是没有任何情况直接访问log_name变量的，只能通过这两个方法来进行间接的访问和设置这个变量，这样的方法同样属于闭包。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span> <span style="color:#666">1</span> <span style="color:#a2f;font-weight:bold">var</span> logHello; <span style="color:#666">2</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">3</span> logHello <span style="color:#666">=</span> ( function () { <span style="color:#666">4</span>     
</span></span><span style="display:flex;"><span> <span style="color:#666">5</span>     <span style="color:#a2f;font-weight:bold">var</span> <span style="color:#a2f">log</span>\_name <span style="color:#666">=</span> <span style="color:#b44">&#39;wyz&#39;</span>;
</span></span><span style="display:flex;"><span> <span style="color:#666">6</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">7</span>     <span style="color:#a2f;font-weight:bold">return</span> { <span style="color:#666">8</span>         read: function () { <span style="color:#666">9</span>             <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">log</span>\_name; <span style="color:#666">10</span> }, <span style="color:#666">11</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">12</span>         write: function (newValue) { <span style="color:#666">13</span>             <span style="color:#a2f">log</span>\_name <span style="color:#666">=</span> newValue; <span style="color:#666">14</span> } <span style="color:#666">15</span> }; <span style="color:#666">16</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">17</span> } )();
</span></span></code></pre></div><h3 id="闭包是怎么形成的">闭包是怎么形成的？ <a href="#%e9%97%ad%e5%8c%85%e6%98%af%e6%80%8e%e4%b9%88%e5%bd%a2%e6%88%90%e7%9a%84" class="anchor">🔗</a></h3><p>从上面可以知道判断一个变量是否可以回收，根据这个变量的是否被引用就可以判断，比如下面例中，局部变量log_name被返回的匿名函数引用，那么就不会被垃圾回收器回收，这就是闭包的形成，因为闭包会保持对变量引用，让垃圾回收器不会回收此变量。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span> <span style="color:#666">1</span> <span style="color:#a2f;font-weight:bold">var</span> logHello; <span style="color:#666">2</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">3</span> logHello <span style="color:#666">=</span> ( function () { <span style="color:#666">4</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">5</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">6</span>     <span style="color:#a2f;font-weight:bold">var</span> <span style="color:#a2f">log</span>\_num <span style="color:#666">=</span> <span style="color:#666">20</span>;
</span></span><span style="display:flex;"><span> <span style="color:#666">7</span> 
</span></span><span style="display:flex;"><span> <span style="color:#666">8</span>     <span style="color:#a2f;font-weight:bold">return</span> function() {
</span></span><span style="display:flex;"><span> <span style="color:#666">9</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">10</span>            <span style="color:#a2f;font-weight:bold">return</span> <span style="color:#a2f">log</span>\_num;       <span style="color:#666">&lt;&lt;</span><span style="">返回一个匿名函数，函数内部可以对局部变量</span><span style="color:#a2f">log</span>\_num进行访问<span style="">。</span> <span style="color:#666">11</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">12</span> }; <span style="color:#666">13</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">14</span> 
</span></span><span style="display:flex;"><span><span style="color:#666">15</span> } )();
</span></span></code></pre></div><p>经过上面的一些例子，就很容易理解了，噢～还没有理解？，那你再继续看看后面的总结吧(但相信我，多思考思考，肯定能理解)。</p>
<p>闭包可以理解为：会保存对变量的引用而不会让变量被垃圾回收器回收。</p>

    </div>

    
        <div class="tags">
            
                <a href="https://wuyizhou.com/tags/%E5%BC%80%E5%8F%91%E8%80%85%E6%89%8B%E5%86%8C">开发者手册</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="your-github-link" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="your-stackoverflow-link" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>stackoverflow</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-488.000000, -1163.000000)">
            <g id="stackoverflow" transform="translate(488.000000, 1163.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M42.0860128,53.5922927 L22.9745951,53.6011499 L22.9729497,49.5538824 L42.0835447,49.5440929 L42.0860128,53.5922927 L42.0860128,53.5922927 Z M55,30.6708298 L51.7306912,12 L47.7087256,12.6920259 L50.9775643,31.3628557 L55,30.6708298 L55,30.6708298 Z M42.5455518,44.3547147 L23.5156994,42.616026 L23.1410164,46.6470941 L42.1712214,48.3841513 L42.5455518,44.3547147 L42.5455518,44.3547147 Z M43.8009984,39.0731519 L25.3459811,34.1539179 L24.285633,38.0621508 L42.7419431,42.9819676 L43.8009984,39.0731519 L43.8009984,39.0731519 Z M46.2103463,34.4436411 L29.7494464,24.8164635 L27.6748215,28.3015328 L44.1365441,37.9292931 L46.2103463,34.4436411 L46.2103463,34.4436411 Z M50.2466504,31.6088756 L46.8745036,33.8883189 L36.106599,18.2318456 L39.4792159,15.9517031 L50.2466504,31.6088756 Z M45.3315807,40.2784283 L48.5799693,40.2784283 L48.5799693,60 L17,60 L17,40.2784283 L20.2648427,40.2784283 L20.2648427,56.8243495 L45.3315807,56.8243495 L45.3315807,40.2784283 Z" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>

    <a class="symbol" href="your-twitter-link" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="438.536px" height="438.536px" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536;"
	 xml:space="preserve">
<g>
	<path d="M414.41,24.123C398.333,8.042,378.963,0,356.315,0H82.228C59.58,0,40.21,8.042,24.126,24.123
		C8.045,40.207,0.003,59.576,0.003,82.225v274.084c0,22.647,8.042,42.018,24.123,58.102c16.084,16.084,35.454,24.126,58.102,24.126
		h274.084c22.648,0,42.018-8.042,58.095-24.126c16.084-16.084,24.126-35.454,24.126-58.102V82.225
		C438.532,59.576,430.49,40.204,414.41,24.123z M335.471,168.735c0.191,1.713,0.288,4.278,0.288,7.71
		c0,15.989-2.334,32.025-6.995,48.104c-4.661,16.087-11.8,31.504-21.416,46.254c-9.606,14.749-21.074,27.791-34.396,39.115
		c-13.325,11.32-29.311,20.365-47.968,27.117c-18.648,6.762-38.637,10.143-59.953,10.143c-33.116,0-63.76-8.952-91.931-26.836
		c4.568,0.568,9.329,0.855,14.275,0.855c27.6,0,52.439-8.565,74.519-25.7c-12.941-0.185-24.506-4.179-34.688-11.991
		c-10.185-7.803-17.273-17.699-21.271-29.691c4.947,0.76,8.658,1.137,11.132,1.137c4.187,0,9.042-0.76,14.56-2.279
		c-13.894-2.669-25.598-9.562-35.115-20.697c-9.519-11.136-14.277-23.84-14.277-38.114v-0.571
		c10.085,4.755,19.602,7.229,28.549,7.422c-17.321-11.613-25.981-28.265-25.981-49.963c0-10.66,2.758-20.747,8.278-30.264
		c15.035,18.464,33.311,33.213,54.816,44.252c21.507,11.038,44.54,17.227,69.092,18.558c-0.95-3.616-1.427-8.186-1.427-13.704
		c0-16.562,5.853-30.692,17.56-42.399c11.703-11.706,25.837-17.561,42.394-17.561c17.515,0,32.079,6.283,43.688,18.846
		c13.134-2.474,25.892-7.33,38.26-14.56c-4.757,14.652-13.613,25.788-26.55,33.402c12.368-1.716,23.88-4.95,34.537-9.708
		C357.458,149.793,347.462,160.166,335.471,168.735z"/>
</g>
</svg>

    </a>


</div>

    

    <div class="copyright">
    
        © Copyright 2023 Yizhou
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-mini'>nodejh</a>
      </div>
    
</footer>



  </body>
</html>
